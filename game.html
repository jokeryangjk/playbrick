<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>game 1</title>
		<style media='screen'>
			canvas{
				border:1px black solid;
			}
		</style>
    </head>
    <body>
		<canvas id='id-canvas' width='400' height='300'></canvas>
<script>
var log = console.log.bind(console)

var imageFromPath = function(path){
	var img = new Image()
	img.src = path
	return img
}

var Paddle = function(){
	var image = imageFromPath('paddle.png')
	var o = {
		image: image,
		x: 100,
		y: 250,
		speed: 15,
	}
	var paddle = o
    o.moveLeft = function() {
        paddle.x -= paddle.speed
    }
    o.moveRight = function() {
        paddle.x += paddle.speed
    }
	return o
}

var GuaGame = function(){
	var g = {
		actions: {},
		keydowns: {},
	}
	var canvas = document.querySelector('#id-canvas')
	var context = canvas.getContext('2d')
	g.canvas = canvas
	g.context = context
	// draw
	g.drawImage = function(guaImage){
		g.context.drawImage(guaImage.image, guaImage.x, guaImage.y)
	}
	// events
	window.addEventListener('keydown', function(event){
		g.keydowns[event.key] = true
	})
	window.addEventListener('keyup', function(event){
		g.keydowns[event.key] = false
	})
	// 
	g.registerAction = function(key, callback){
		g.actions[key] = callback
	}
	// timer

	setInterval(function(){
		// events
		var actions = Object.keys(g.actions)
		for(var i = 0; i < actions.length; i++){
			var key = actions[i]
			if(g.keydowns[key]){
				// 如果案件被按下， 调用注册的 action
				g.actions[key]()
			}
		}
		// update
		g.update()
		// clear
		context.clearRect(0,0,canvas.width,canvas.height)
		// draw
		g.draw()
	},1000/30)
	return g
}
var _main = function(){
	var game = GuaGame()
	var paddle = Paddle()

	game.registerAction('a', function(){
		paddle.moveLeft()
	})
	game.registerAction('d', function(){
		paddle.moveRight()
	})
	game.update = function(){}
	game.draw = function(){
		//draw
		game.drawImage(paddle)
	}
}

_main()
</script>
    </body>
</html>